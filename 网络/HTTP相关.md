## HTTP相关



### 0. 计算机网络基础

- 计算机网络是分层管理的，常用的有**OSI 7层结构**和简化后的**TCP/IP 5层结构**。
  - OSI 7层结构：应用层、表示层、会话层、传输层、网络层、（数据）链路层、物理层。
  - TCP/IP 5层结构：应用层、传输层、网络层、（数据）链路层、物理层。
  - TCP/IP 5层结构将OSI 7层结构中的应用层、表示层、会话层合并到了应用层。
- 为什么层次化设计？
  - **每层的责任和分工明确，独自都能便于扩展，层间通过接口通信**。

- 每一层有自己适用的协议，比如网络层使用IP协议、传输层使用TCP或者UDP协议等等。
- 而HTTP是在应用层上的协议，建立在TCP/IP之上。
- 对于网络分层结构，发送端从上往下传递数据，每经过一层都需要添加上该层特有的头部信息。接收端从下往上解析数据，每经过一层会将该层的头部信息去掉。



### 1. TCP/IP

- 不同的硬件、操作系统之间通信总是需要通过一定的规则，而这种规则就能称之为**协议(Protocol)**。
- TCP/IP一般认为是一种在IP协议通信过程中会用到的协议的总称，HTTP通常认为是其中的一个子集。

#### 1.1 与HTTP关系密切的协议

- **IP(Internet Protocol)协议**：**属于网络层**，几乎所有网络系统都会使用到IP协议。
  - 作用就是将各种数据包传送到对方，保证准确送达对方，核心就是**IP地址**和**Mac地址**。
  - IP地址是该节点被分配到的地址，Mac地址指该节点的网卡地址。**一般IP地址可变化，Mac地址不可变化**。
  - IP之间的通信依赖于Mac地址，一般情况下设备在同一局域网（LAN）的情况比较少，需要经过多台网络设备中转，这时候就会用到**ARP(Address Resolution Protocol)协议**。
  - **ARP协议是用来解析MAC地址的协议，通过对方的IP地址就能反查出MAC地址**。
  - *关于ARP协议属于哪一层的问题。在OSI 7层结构中属于链路层，在TCP/IP 5层结构中属于网络层，实际上具体所属并不是特别准确。*
- **TCP(Transmission Control Protocol)协议：属于传输层**，提供**可靠的传输服务**。
  - **可靠的传输**指的是能把数据准确可靠地传到对方。
  - 所谓的传输服务是将大数据分割成以**报文段(segment)**为单位的数据包进行管理。

- **DNS(Domain Name System)协议：属于引用层**，提供域名到IP之间的解析服务。
  - 域名是字母配合数字的组合，比只有数字的IP更有辨识度，同时更好理解记忆。
  - 但计算机无法直接理解域名，因此需要通过DNS将域名解析为IP。
  - 通常这个DNS服务由专门的服务器提供。



### 2. HTTP

#### 2.1 HTTP的特点

**HTTP(Hypertext Transfer Protocol)协议：属于应用层**，用于实现客户端和服务端的通信。

- 在HTTP协议下，必定存在客户端和服务端的分别。客户端发出请求，服务端才能有所响应。也就是说客户端开始建立通信，服务端在没收到请求前是不会发送响应的。
- HTTP是**无状态协议**，**自身不对请求和响应之间的通信状态进行保存**，换句话说在HTTP这一层，对发送过的请求或响应都不做持久化处理。
  - **例如用户在登录某站点时，HTTP本身就不能记录用户登陆状态，因此正用户跳转页面同时还需要保持用户状态对于无状态的HTTP来说是无法实现的。因此需要引入Cookie技术，为HTTP的通信添加状态。**



#### 2.2 HTTP的请求方法

- **GET：获取资源**
  - get方法用来请求访问已被URI识别的资源，指定资源经服务端解析后返回响应内容。
- **POST：传输实体主体**
  - post方法用来传输数据。
- **GET与POST之间相似点和区别**
  - **get与post都能传输数据，但get常用于获取，post常用于提交。**
  - **get会被浏览器缓存、收藏书签、保留浏览器历史记录，post不会。**
  - **post有比get更好的安全性，因为post数据在body中而get的数据在url中。**
  - **请求参数get由于是在url中，因此会受到url编码的限制，而post是在body中，不会受到编码的限制。**
  - **url长度在不同的浏览器中有不同的限制，最好是不要超过2k字符，所以get方法的参数传递有数量限制。**



#### 2.3 HTTP的请求报文

- 请求报文由**请求方法、请求URI、协议版本、可选的请求header字段和内容实体(body)**组成。
- **header字段与body之间会有一个换行符\r\n隔开**。

```http
GET /index.html HTTP/1.1
HOST: my.com
Connection: keep-alive
Content-Type: application/x-www-form-urlencoded
Content-Length: 16

name=windy&age=20
```



#### 2.4 HTTP的响应报文

- 响应报文由**协议版本、状态码、用以解释状态码的原因短句、可选的响应header字段和内容实体**组成。
- **header字段与body之间会有一个换行符\r\n隔开**。

```http
HTTP/1.1 200 OK
Date: ...
Content-Length: 300
Content-Type: text/html

<html>
...
```



#### 2.5 HTTP的持久连接与管线化

- 由于原来的HTTP协议在每一次数据传输都需要建立和关闭连接，对于网页数据量繁多的情况就不适用。
- 因此在HTTP/1.1全面支持了**持久连接(keep-alive)**的技术，所有连接在HTTP/1.1是默认持久连接的。
  - **持久连接就是在建立连接后，任意一方没有明确断开连接，就始终保持TCP连接状态**。
- **管线化(pipelining)**技术，在持久连接的基础上，**实现请求发送不用等待收到上一份请求的响应**。
  - 可以认为之前的HTTP请求是同步的，必须要完成了一个请求才能继续下一个请求，但现在有了管线化技术HTTP请求就是异步的。



#### 2.6 使用Cookie管理状态

- Cookie技术主要实现的是**在请求和响应的报文中写入Cookie信息来控制客户端的状态**。
- cookie的生成流程是这样的：
  - **客户端发送没有cookie信息的请求给服务端。**
  - **服务端处理完成后，在响应报文的header的set-cookie字段中写入生成的标识状态的cookie值。**
  - **客户端缓存到header的set-cookie字段中的cookie值，并在之后的访问该站点时带上该cookie值标识状态。**



### 3. HTTP的状态码

- HTTP通过状态码让客户端快速知道请求结果如何。
- 第一位制定了响应类别，对应一种大类
  - **1XX：信息性状态码，接收的信息正在处理**
  - **2XX：成功状态码，请求正常处理**
  - **3XX：重定向状态码，需要进行附加操作以完成请求**
  - **4XX：客户端错误状态码，服务器无法处理请求**
  - **5XX：服务端错误状态码，服务端处理请求出错**

#### 3.1 2XX状态码

- **200 OK**：表示客户端请求被服务端正常处理。
- **204 No Content**：表示服务端正常接收的客户端的请求正常处理，但body中不需要返回任何内容。
- 206 Partial Content：客户端发起了范围请求，服务器成功执行请求，响应报文中包含Content-Range字段。

#### 3.2 3XX状态码

- **301 Moved Permanently**：永久性重定向，表示请求的资源已经有了新的URI，以后请使用新的URI。
- 302 Found：临时性重定向，表示请求的资源已有新的URI，希望本次能使用新的URI。
- 303 See Other：表示由于请求的资源有了新的URI，应使用GET方法访问新的URI。
- **304 Not Modified**：表示用户发送附带条件的请求时，发生未满足请求条件时，直接返回。不包含任何body。
- 307 Temporary Redirect：与302相同，但不会将post变为get方法。

#### 3.3 4XX状态码

- **400 Bad Request**：表示请求报文中存在语法错误。
- 401 Unauthorized：表示发送的请求有通过HTTP认证的认证信息。
- **403 Forbidden**：该状态码表明请求的资源被服务器拒绝（可能是访问权限问题）。
- **404 Not Found**：该服务器上没有请求的资源，也可以类似于403使用。

#### 3.4 5XX 状态码

- **500 Internal Server Error**：服务端在执行请求时发生了错误。
- 503 Service Unavailable：服务器现在暂时无法处理该请求，可以在响应报文的Retry-After字段中写入等待时间。



### 4. HTTPS

- HTTP协议本身存在一些问题：
  - **通信使用明文，内容可能被窃听**。
  - **不验证通信方的身份，因此可能伪装**。
  - **无法证明报文的完整性，因此可能以遭篡改**。
- **明文通信**
  - 在互联网上的任何位置上都可能被监听，也就能抓取数据包。
  - 因此能通过对**报文加密**来解决安全问题。**SSL(Secure Socket Layer)**或者**TLS(Transport Layer Security)**的组合使用，加密报文

- 

