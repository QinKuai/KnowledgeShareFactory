## TCP相关

### TCP

- 什么是TCP？**面向连接的可靠的传输协议**。
  - 连接：
    - 可以理解为一个socket（IP+端口号，记录自己的和对方的）。
    - 一般端口号的最大数目为65535个，但不代表一台主机只支持该最大数目的连接。可以因为连接对象主机不同、或是有多网卡（多IP）。
    - 对于连接的两端来说，连接是双向的。
    - 在完成三次握手后，双方在内存区域开辟内存资源以建立连接。
  - 可靠：
    - 存在ack包保证每次传输都正常抵达，类似于三次握手的流程。若没有返回ack包就会重传。

- TCP/IP将OSI 7层模型省略为了5层结构，包含**应用层、传输控制层、网络层、链路层、物理层**。
- **连接**是在传输控制层以下的所有层，将两个物理端口建立连接，**通信**基于应用层支持的通信协议实现两个端口之间的通信。
  - 建立连接事实上就是申请资源，断开连接事实上就是释放资源。
- TCP的可靠性:
  - 在任意一方发送数据时，如果对方正确接收该数据，则一定会返回一个ack包，不然就会重传。

- **三次握手**
  - C端发送syn包给S端；
  - S端发送syn+ack包给C端；（确保C能知道自己能发往S）
  - C端发送ack包给S端。（确保S能知道自己能发往C）
- **四次挥手**
  - C端发送fin包给S端；
  - S端发送fin+ack包给C端；（确保S端收到了C端的fin包）
  - S端发送fin包给C端；
  - C端发送ack包给S端。（确保C端收到了S端的fin包）